<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Case Clicker{% endblock %}</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='media/logo.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/all.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="preload" href="{{ url_for('static', filename='media/cases/weapon_case_1.png') }}" as="image">
    <link rel="preload" href="{{ url_for('static', filename='media/cases/esports_2013_case.png') }}" as="image">
</head>
<body>
    <div class="rank-progress">
        <div class="rank-info">
            <span class="current-rank" data-rank="{{ rank }}">{{ RANKS[rank] }}</span>
            <div class="progress-bar">
                {% if rank < 17 %}
                    <div class="progress-fill" style='width: {{ (exp / RANK_EXP[rank] * 100)|round(2) }}%'></div>
                {% else %}
                    <div class="progress-fill" style="width: 100%"></div>
                {% endif %}
            </div>
            <span class="exp-info">
                {% if rank < 17 %}
                    {{ exp|int }}/{{ RANK_EXP[rank] }} EXP
                {% else %}
                    MAX RANK
                {% endif %}
            </span>
        </div>
    </div>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-links">
                <a href="{{ url_for('index') }}" class="nav-link {{ 'active' if request.endpoint == 'index' }}">Home</a>
                <a href="{{ url_for('shop') }}" class="nav-link {{ 'active' if request.endpoint == 'shop' }}">Shop</a>
                <a href="{{ url_for('inventory') }}" class="nav-link {{ 'active' if request.endpoint == 'inventory' }}">Inventory</a>
                <a href="{{ url_for('clicker') }}" class="nav-link {{ 'active' if request.endpoint == 'clicker' }}">Clicker</a>
                <a href="{{ url_for('upgrades') }}" class="nav-link {{ 'active' if request.endpoint == 'upgrades' }}">Upgrades</a>
                <a href="{{ url_for('casino') }}" class="nav-link {{ 'active' if request.endpoint == 'casino' }}">Casino</a>
                <a href="{{ url_for('trading') }}" class="nav-link {{ 'active' if request.endpoint == 'trading' }}">Trading</a>
                <a href="{{ url_for('achievements') }}" class="nav-link {{ 'active' if request.endpoint == 'achievements' }}">Achievements</a>
                <a href="{{ url_for('auction') }}" class="nav-link {{ 'active' if request.endpoint == 'auction' }}">Auction</a>
            </div>
            <div class="balance">Balance: $<span id="balance">{{ "%.2f"|format(balance) }}</span></div>
        </div>
    </nav>

    <div class="container">
        {% block content %}{% endblock %}
    </div>

    <div class="watermark">
        <span>Made by Ole Kristian Westby</span>
    </div>

    <script src="{{ url_for('static', filename='js/auto_clicker.js') }}"></script>
    {% block scripts %}{% endblock %}

    <script>
    // Make RANKS available globally
    const RANKS = {{ RANKS|tojson|safe }};

    // Define case mapping globally
    const CASE_MAPPING = {
        'csgo': 'weapon_case_1',
        'esports': 'esports_2013',
        'bravo': 'operation_bravo_case',
        'csgo2': 'weapon_case_2',
        'esports_winter': 'esports_2013_winter',
        'winter_offensive': 'winter_offensive_case',
        'csgo3': 'weapon_case_3',
        'phoenix': 'operation_phoenix_case',
        'huntsman': 'huntsman_case',
        'breakout': 'operation_breakout_case',
        'esports_summer': 'esports_2014_summer',
        'vanguard': 'operation_vanguard_case',
        'chroma': 'chroma_case',
        'chroma_2': 'chroma_2_case',
        'falchion': 'falchion_case',
        'shadow': 'shadow_case',
        'revolution': 'revolution_case',
        'wildfire': 'operation_wildfire_case',
        'revolver': 'revolver_case',
        'gamma': 'gamma_case',
        'gamma_2': 'gamma_2_case',
        'chroma_3': 'chroma_3_case',
        'hydra': 'operation_hydra_case',
        'glove': 'glove_case',
        'spectrum': 'spectrum_case',
        'spectrum_2': 'spectrum_2_case'
    };

    // Add CASE_SKINS_FOLDER_NAMES mapping
    const CASE_SKINS_FOLDER_NAMES = {
        'csgo': 'weapon_case_1',
        'esports': 'esports_2013',
        'bravo': 'operation_bravo_case',
        'csgo2': 'weapon_case_2',
        'esports_winter': 'esports_2013_winter',
        'winter_offensive': 'winter_offensive_case',
        'csgo3': 'weapon_case_3',
        'phoenix': 'operation_phoenix_case',
        'huntsman': 'huntsman_case',
        'breakout': 'operation_breakout_case',
        'esports_summer': 'esports_2014_summer',
        'vanguard': 'operation_vanguard_case',
        'chroma': 'chroma_case',
        'chroma_2': 'chroma_2_case',
        'chroma_3': 'chroma_3_case',
        'falchion': 'falchion_case',
        'shadow': 'shadow_case',
        'revolution': 'revolution_case',
        'wildfire': 'operation_wildfire_case',
        'revolver': 'revolver_case',
        'gamma': 'gamma_case',
        'gamma_2': 'gamma_2_case',
        'hydra': 'operation_hydra_case',
        'glove': 'glove_case',
        'spectrum': 'spectrum_case',
        'spectrum_2': 'spectrum_2_case'
    };

    // Function to update rank progress UI
    function updateRankProgress(exp, rank, rankName, nextRankExp) {
        // Update rank name
        const rankElement = document.querySelector('.current-rank');
        if (rankElement) {
            rankElement.textContent = rankName;
            rankElement.dataset.rank = rank;
        }
        
        // Update progress bar
        const progressFill = document.querySelector('.progress-fill');
        if (progressFill) {
            if (nextRankExp) {
                const percentage = (exp / nextRankExp * 100).toFixed(2);
                progressFill.style.width = `${percentage}%`;
            } else {
                progressFill.style.width = '100%';
            }
        }
        
        // Update exp text
        const expInfo = document.querySelector('.exp-info');
        if (expInfo) {
            if (nextRankExp) {
                expInfo.textContent = `${Math.floor(exp)}/${nextRankExp} EXP`;
            } else {
                expInfo.textContent = 'MAX RANK';
            }
        }
    }

    // Function to create confetti effect
    function createConfetti() {
        const confettiContainer = document.createElement('div');
        confettiContainer.className = 'confetti-container';
        document.body.appendChild(confettiContainer);
        
        const colors = ['#ffd700', '#ff0000', '#00ff00', '#0000ff', '#ff00ff', '#00ffff'];
        
        for (let i = 0; i < 100; i++) {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.style.left = Math.random() * 100 + 'vw';
            confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.animation = `confettiFall ${1 + Math.random() * 2}s linear forwards`;
            confetti.style.animationDelay = Math.random() * 3 + 's';
            confettiContainer.appendChild(confetti);
        }
        
        setTimeout(() => {
            confettiContainer.remove();
        }, 5000);
    }

    // Function to show level up banner
    function showLevelUpBanner(newRank) {
        const banner = document.createElement('div');
        banner.className = 'level-up-banner';
        banner.innerHTML = `<h2>LEVEL UP: ${newRank}</h2>`;
        document.body.appendChild(banner);
        
        setTimeout(() => {
            banner.remove();
        }, 3000);
    }

    // Function to handle achievement completion response
    function handleAchievementComplete(data) {
        // Update balance
        const balanceElement = document.getElementById('balance');
        if (balanceElement) {
            balanceElement.textContent = data.balance.toFixed(2);
        }
        
        // Update rank progress
        updateRankProgress(data.exp, data.rank, data.rankName, data.nextRankExp);
        
        // Show achievement completion popup if there's achievement data
        if (data.achievement) {
            showAchievementPopup(data.achievement);
        }
        
        // Show level up animation if needed
        if (data.levelUp) {
            createConfetti();
            showLevelUpBanner(data.rankName);
        }
    }

    // Function to show achievement completion popup
    function showAchievementPopup(achievement) {
        const popup = document.createElement('div');
        popup.className = 'achievement-popup';
        
        // Format rewards text based on whether there's EXP reward
        const rewardsText = achievement.exp_reward > 0 
            ? `+$${achievement.reward.toLocaleString()} â€¢ ${achievement.exp_reward.toLocaleString()} EXP`
            : `+$${achievement.reward.toLocaleString()}`;
        
        popup.innerHTML = `
            <div class="icon">${achievement.icon}</div>
            <div class="content">
                <div class="title">Achievement Unlocked!</div>
                <div class="description">${achievement.title}</div>
                <div class="rewards">
                    ${rewardsText}
                </div>
            </div>
        `;
        
        document.body.appendChild(popup);
        
        // Remove popup after animation
        setTimeout(() => {
            popup.remove();
        }, 4000);
    }
    </script>
</body>
</html> 