<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Case Clicker{% endblock %}</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='media/logo.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="preload" href="{{ url_for('static', filename='media/cases/weapon_case_1.png') }}" as="image">
    <link rel="preload" href="{{ url_for('static', filename='media/cases/esports_2013_case.png') }}" as="image">
    <style>
    .confetti-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 9999;
    }

    .level-up-banner {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: linear-gradient(135deg, #ffd700, #ffa500);
        padding: 20px 40px;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        z-index: 10000;
        animation: bannerFade 3s ease-in-out forwards;
        text-align: center;
    }

    .level-up-banner h2 {
        margin: 0;
        color: #fff;
        font-size: 32px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }

    @keyframes bannerFade {
        0% { opacity: 0; transform: translate(-50%, -40%); }
        10% { opacity: 1; transform: translate(-50%, -50%); }
        80% { opacity: 1; transform: translate(-50%, -50%); }
        100% { opacity: 0; transform: translate(-50%, -60%); }
    }

    .confetti {
        position: absolute;
        width: 10px;
        height: 10px;
        background-color: #ffd700;
        opacity: 0;
    }

    @keyframes confettiFall {
        0% { transform: translateY(-100%) rotate(0deg); opacity: 1; }
        100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
    }

    .balance, .current-rank, .exp-info {
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }

    .nav-link {
        position: relative;
        transition: color 0.3s ease;
    }

    .nav-link.active {
        color: #ffd700;
    }

    .nav-link.active::after {
        content: '';
        position: absolute;
        bottom: -2px;
        left: 0;
        width: 100%;
        height: 2px;
        background-color: #ffd700;
        animation: slideIn 0.3s ease-out forwards;
    }

    @keyframes slideIn {
        from {
            transform: scaleX(0);
        }
        to {
            transform: scaleX(1);
        }
    }

    /* Achievement popup styles */
    .achievement-popup {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: linear-gradient(135deg, #2a2a2a, #1a1a1a);
        border: 2px solid #ffd700;
        border-radius: 10px;
        padding: 15px 20px;
        color: white;
        z-index: 10000;
        animation: achievementSlide 4s ease-in-out forwards;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        display: flex;
        align-items: center;
        gap: 15px;
        min-width: 300px;
    }

    .achievement-popup .icon {
        font-size: 24px;
        background: rgba(255, 215, 0, 0.1);
        padding: 10px;
        border-radius: 50%;
    }

    .achievement-popup .content {
        flex-grow: 1;
    }

    .achievement-popup .title {
        color: #ffd700;
        font-weight: bold;
        margin-bottom: 5px;
    }

    .achievement-popup .rewards {
        font-size: 0.9em;
        color: #aaa;
    }

    @keyframes achievementSlide {
        0% { transform: translateX(120%); opacity: 0; }
        15% { transform: translateX(0); opacity: 1; }
        85% { transform: translateX(0); opacity: 1; }
        100% { transform: translateX(120%); opacity: 0; }
    }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-links">
                <a href="{{ url_for('index') }}" class="nav-link {{ 'active' if request.endpoint == 'index' }}">Home</a>
                <a href="{{ url_for('shop') }}" class="nav-link {{ 'active' if request.endpoint == 'shop' }}">Shop</a>
                <div class="rank-progress">
                    <div class="rank-info">
                        <span class="current-rank" data-rank="{{ rank }}">{{ RANKS[rank] }}</span>
                        <div class="progress-bar">
                            {% if rank < 17 %}
                                <div class="progress-fill" style='width: {{ (exp / RANK_EXP[rank] * 100)|round(2) }}%'></div>
                            {% else %}
                                <div class="progress-fill" style="width: 100%"></div>
                            {% endif %}
                        </div>
                        <span class="exp-info">
                            {% if rank < 17 %}
                                {{ exp|int }}/{{ RANK_EXP[rank] }} EXP
                            {% else %}
                                MAX RANK
                            {% endif %}
                        </span>
                    </div>
                </div>
                <a href="{{ url_for('inventory') }}" class="nav-link {{ 'active' if request.endpoint == 'inventory' }}">Inventory</a>
                <a href="{{ url_for('clicker') }}" class="nav-link {{ 'active' if request.endpoint == 'clicker' }}">Clicker</a>
                <a href="{{ url_for('upgrades') }}" class="nav-link {{ 'active' if request.endpoint == 'upgrades' }}">Upgrades</a>
                <a href="{{ url_for('casino') }}" class="nav-link {{ 'active' if request.endpoint == 'casino' }}">Casino</a>
                <a href="{{ url_for('trading') }}" class="nav-link {{ 'active' if request.endpoint == 'trading' }}">Trading</a>
                <a href="{{ url_for('achievements') }}" class="nav-link {{ 'active' if request.endpoint == 'achievements' }}">Achievements</a>
            </div>
            <div class="balance">Balance: $<span id="balance">{{ "%.2f"|format(balance) }}</span></div>
        </div>
    </nav>

    <div class="container">
        {% block content %}{% endblock %}
    </div>

    <div class="watermark">
        <span>Made by Ole Kristian Westby</span>
    </div>

    <script src="{{ url_for('static', filename='js/auto_clicker.js') }}"></script>
    {% block scripts %}{% endblock %}

    <script>
    // Function to update rank progress UI
    function updateRankProgress(exp, rank, rankName, nextRankExp) {
        // Update rank name
        const rankElement = document.querySelector('.current-rank');
        if (rankElement) {
            rankElement.textContent = rankName;
            rankElement.dataset.rank = rank;
        }
        
        // Update progress bar
        const progressFill = document.querySelector('.progress-fill');
        if (progressFill) {
            if (nextRankExp) {
                const percentage = (exp / nextRankExp * 100).toFixed(2);
                progressFill.style.width = `${percentage}%`;
            } else {
                progressFill.style.width = '100%';
            }
        }
        
        // Update exp text
        const expInfo = document.querySelector('.exp-info');
        if (expInfo) {
            if (nextRankExp) {
                expInfo.textContent = `${Math.floor(exp)}/${nextRankExp} EXP`;
            } else {
                expInfo.textContent = 'MAX RANK';
            }
        }
    }

    // Function to create confetti effect
    function createConfetti() {
        const confettiContainer = document.createElement('div');
        confettiContainer.className = 'confetti-container';
        document.body.appendChild(confettiContainer);
        
        const colors = ['#ffd700', '#ff0000', '#00ff00', '#0000ff', '#ff00ff', '#00ffff'];
        
        for (let i = 0; i < 100; i++) {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.style.left = Math.random() * 100 + 'vw';
            confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.animation = `confettiFall ${1 + Math.random() * 2}s linear forwards`;
            confetti.style.animationDelay = Math.random() * 3 + 's';
            confettiContainer.appendChild(confetti);
        }
        
        setTimeout(() => {
            confettiContainer.remove();
        }, 5000);
    }

    // Function to show level up banner
    function showLevelUpBanner(newRank) {
        const banner = document.createElement('div');
        banner.className = 'level-up-banner';
        banner.innerHTML = `<h2>LEVEL UP: ${newRank}</h2>`;
        document.body.appendChild(banner);
        
        setTimeout(() => {
            banner.remove();
        }, 3000);
    }

    // Function to handle achievement completion response
    function handleAchievementComplete(data) {
        // Update balance
        const balanceElement = document.getElementById('balance');
        if (balanceElement) {
            balanceElement.textContent = data.balance.toFixed(2);
        }
        
        // Update rank progress
        updateRankProgress(data.exp, data.rank, data.rankName, data.nextRankExp);
        
        // Show achievement completion popup if there's achievement data
        if (data.achievement) {
            showAchievementPopup(data.achievement);
        }
        
        // Show level up animation if needed
        if (data.levelUp) {
            createConfetti();
            showLevelUpBanner(data.rankName);
        }
    }

    // Function to show achievement completion popup
    function showAchievementPopup(achievement) {
        const popup = document.createElement('div');
        popup.className = 'achievement-popup';
        
        popup.innerHTML = `
            <div class="icon">${achievement.icon}</div>
            <div class="content">
                <div class="title">Achievement Unlocked!</div>
                <div class="description">${achievement.title}</div>
                <div class="rewards">
                    +$${achievement.reward.toLocaleString()} • ${achievement.exp_reward.toLocaleString()} EXP
                </div>
            </div>
        `;
        
        document.body.appendChild(popup);
        
        // Remove popup after animation
        setTimeout(() => {
            popup.remove();
        }, 4000);
    }
    </script>
</body>
</html> 